const translations = {
    ru: {
        balance: 'Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ', synced: 'Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾', saved: 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾',
        monthIncome: 'Ğ”Ğ¾Ñ…Ğ¾Ğ´ (Ğ¼ĞµÑÑÑ†)', monthExpense: 'Ğ Ğ°ÑÑ…Ğ¾Ğ´ (Ğ¼ĞµÑÑÑ†)',
        upcomingBills: 'ĞŸÑ€ĞµĞ´ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ğµ ÑÑ‡ĞµÑ‚Ğ°', recentTrans: 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸',
        income: 'Ğ”Ğ¾Ñ…Ğ¾Ğ´', expense: 'Ğ Ğ°ÑÑ…Ğ¾Ğ´', bill: 'Ğ¡Ñ‡Ñ‘Ñ‚',
        amount: 'Ğ¡ÑƒĞ¼Ğ¼Ğ° ($)', description: 'ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ', date: 'Ğ”Ğ°Ñ‚Ğ°', category: 'ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ',
        addIncome: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ¾Ñ…Ğ¾Ğ´', addExpense: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑ…Ğ¾Ğ´', addBill: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‡Ñ‘Ñ‚',
        billName: 'ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ‡Ñ‘Ñ‚Ğ°', dueDate: 'Ğ¡Ñ€Ğ¾Ğº Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹', recurring: 'Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶',
        allTrans: 'Ğ’ÑĞµ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸', categoryStats: 'Ğ Ğ°ÑÑ…Ğ¾Ğ´Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼',
        home: 'Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ', add: 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ', history: 'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ', stats: 'Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°',
        pay: 'ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ', delete: 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ',
        utilities: 'ĞšĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ°Ğ»ĞºĞ°', education: 'Ğ¨ĞºĞ¾Ğ»Ğ°', subscriptions: 'ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸',
        creditCards: 'ĞšÑ€ĞµĞ´Ğ¸Ñ‚ĞºĞ¸', groceries: 'ĞŸÑ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹', transport: 'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚',
        entertainment: 'Ğ Ğ°Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ', health: 'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ', other: 'Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ',
        noBills: 'ĞĞµÑ‚ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ñ… ÑÑ‡ĞµÑ‚Ğ¾Ğ²', noTrans: 'ĞĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹',
        noStats: 'ĞĞµÑ‚ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ¾Ğ² Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°',
        overdue: 'ĞŸÑ€Ğ¾ÑÑ€Ğ¾Ñ‡ĞµĞ½!', today: 'Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ', tomorrow: 'Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°',
        canSave: 'ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ', currentBal: 'Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ',
        unpaidBills: 'ĞĞµĞ¾Ğ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ½Ñ‹Ğµ ÑÑ‡ĞµÑ‚Ğ°', freeAmount: 'Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾',
        incomeAdded: 'Ğ”Ğ¾Ñ…Ğ¾Ğ´ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½!', expenseAdded: 'Ğ Ğ°ÑÑ…Ğ¾Ğ´ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½!',
        billAdded: 'Ğ¡Ñ‡Ñ‘Ñ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½!', billPaid: 'Ğ¡Ñ‡Ñ‘Ñ‚ Ğ¾Ğ¿Ğ»Ğ°Ñ‡ĞµĞ½!',
        confirmDelete: 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ ÑÑ‡Ñ‘Ñ‚?', confirmLogout: 'Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ²Ñ‹Ğ¹Ñ‚Ğ¸?'
    },
    en: {
        balance: 'Current Balance', synced: 'Synced', saved: 'Saved',
        monthIncome: 'Income (month)', monthExpense: 'Expense (month)',
        upcomingBills: 'Upcoming Bills', recentTrans: 'Recent Transactions',
        income: 'Income', expense: 'Expense', bill: 'Bill',
        amount: 'Amount ($)', description: 'Description', date: 'Date', category: 'Category',
        addIncome: 'Add Income', addExpense: 'Add Expense', addBill: 'Add Bill',
        billName: 'Bill Name', dueDate: 'Due Date', recurring: 'Recurring payment',
        allTrans: 'All Transactions', categoryStats: 'Expenses by Category',
        home: 'Home', add: 'Add', history: 'History', stats: 'Stats',
        pay: 'Pay', delete: 'Delete',
        utilities: 'Utilities', education: 'Education', subscriptions: 'Subscriptions',
        creditCards: 'Credit Cards', groceries: 'Groceries', transport: 'Transport',
        entertainment: 'Entertainment', health: 'Health', other: 'Other',
        noBills: 'No upcoming bills', noTrans: 'No transactions',
        noStats: 'No expenses to analyze',
        overdue: 'Overdue!', today: 'Today', tomorrow: 'Tomorrow',
        canSave: 'Can Save', currentBal: 'Current Balance',
        unpaidBills: 'Unpaid Bills', freeAmount: 'Available',
        incomeAdded: 'Income added!', expenseAdded: 'Expense added!',
        billAdded: 'Bill added!', billPaid: 'Bill paid!',
        confirmDelete: 'Delete this bill?', confirmLogout: 'Are you sure you want to log out?'
    },
    uk: {
        balance: 'ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ', synced: 'Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ñ–Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾', saved: 'Ğ—Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ¾',
        monthIncome: 'Ğ”Ğ¾Ñ…Ñ–Ğ´ (Ğ¼Ñ–ÑÑÑ†ÑŒ)', monthExpense: 'Ğ’Ğ¸Ñ‚Ñ€Ğ°Ñ‚Ğ¸ (Ğ¼Ñ–ÑÑÑ†ÑŒ)',
        upcomingBills: 'ĞœĞ°Ğ¹Ğ±ÑƒÑ‚Ğ½Ñ– Ñ€Ğ°Ñ…ÑƒĞ½ĞºĞ¸', recentTrans: 'ĞÑÑ‚Ğ°Ğ½Ğ½Ñ– Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ—',
        income: 'Ğ”Ğ¾Ñ…Ñ–Ğ´', expense: 'Ğ’Ğ¸Ñ‚Ñ€Ğ°Ñ‚Ğ°', bill: 'Ğ Ğ°Ñ…ÑƒĞ½Ğ¾Ğº',
        amount: 'Ğ¡ÑƒĞ¼Ğ° ($)', description: 'ĞĞ¿Ğ¸Ñ', date: 'Ğ”Ğ°Ñ‚Ğ°', category: 'ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–Ñ',
        addIncome: 'Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ´Ğ¾Ñ…Ñ–Ğ´', addExpense: 'Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ²Ğ¸Ñ‚Ñ€Ğ°Ñ‚Ñƒ', addBill: 'Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ñ€Ğ°Ñ…ÑƒĞ½Ğ¾Ğº',
        billName: 'ĞĞ°Ğ·Ğ²Ğ° Ñ€Ğ°Ñ…ÑƒĞ½ĞºÑƒ', dueDate: 'Ğ¢ĞµÑ€Ğ¼Ñ–Ğ½ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸', recurring: 'Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¸Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ–Ğ¶',
        allTrans: 'Ğ’ÑÑ– Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ—', categoryStats: 'Ğ’Ğ¸Ñ‚Ñ€Ğ°Ñ‚Ğ¸ Ğ·Ğ° ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–ÑĞ¼Ğ¸',
        home: 'Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°', add: 'Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸', history: 'Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ', stats: 'Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°',
        pay: 'ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚Ğ¸', delete: 'Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸',
        utilities: 'ĞšĞ¾Ğ¼ÑƒĞ½Ğ°Ğ»ÑŒĞ½Ñ–', education: 'Ğ¨ĞºĞ¾Ğ»Ğ°', subscriptions: 'ĞŸÑ–Ğ´Ğ¿Ğ¸ÑĞºĞ¸',
        creditCards: 'ĞšÑ€ĞµĞ´Ğ¸Ñ‚ĞºĞ¸', groceries: 'ĞŸÑ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸', transport: 'Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚',
        entertainment: 'Ğ Ğ¾Ğ·Ğ²Ğ°Ğ³Ğ¸', health: 'Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²\'Ñ', other: 'Ğ†Ğ½ÑˆĞµ',
        noBills: 'ĞĞµĞ¼Ğ°Ñ” Ğ¼Ğ°Ğ¹Ğ±ÑƒÑ‚Ğ½Ñ–Ñ… Ñ€Ğ°Ñ…ÑƒĞ½ĞºÑ–Ğ²', noTrans: 'ĞĞµĞ¼Ğ°Ñ” Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ğ¹',
        noStats: 'ĞĞµĞ¼Ğ°Ñ” Ğ²Ğ¸Ñ‚Ñ€Ğ°Ñ‚ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·Ñƒ',
        overdue: 'ĞŸÑ€Ğ¾ÑÑ‚Ñ€Ğ¾Ñ‡ĞµĞ½Ğ¾!', today: 'Ğ¡ÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–', tomorrow: 'Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°',
        canSave: 'ĞœĞ¾Ğ¶Ğ½Ğ° Ğ²Ñ–Ğ´ĞºĞ»Ğ°ÑÑ‚Ğ¸', currentBal: 'ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ',
        unpaidBills: 'ĞĞµĞ¾Ğ¿Ğ»Ğ°Ñ‡ĞµĞ½Ñ– Ñ€Ğ°Ñ…ÑƒĞ½ĞºĞ¸', freeAmount: 'Ğ’Ñ–Ğ»ÑŒĞ½Ğ¾',
        incomeAdded: 'Ğ”Ğ¾Ñ…Ñ–Ğ´ Ğ´Ğ¾Ğ´Ğ°Ğ½Ğ¾!', expenseAdded: 'Ğ’Ğ¸Ñ‚Ñ€Ğ°Ñ‚Ñƒ Ğ´Ğ¾Ğ´Ğ°Ğ½Ğ¾!',
        billAdded: 'Ğ Ğ°Ñ…ÑƒĞ½Ğ¾Ğº Ğ´Ğ¾Ğ´Ğ°Ğ½Ğ¾!', billPaid: 'Ğ Ğ°Ñ…ÑƒĞ½Ğ¾Ğº Ğ¾Ğ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ¾!',
        confirmDelete: 'Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ñ†ĞµĞ¹ Ñ€Ğ°Ñ…ÑƒĞ½Ğ¾Ğº?', confirmLogout: 'Ğ’Ğ¸ Ğ²Ğ¿ĞµĞ²Ğ½ĞµĞ½Ñ–, Ñ‰Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ²Ğ¸Ğ¹Ñ‚Ğ¸?'
    }
};

let currentLang = localStorage.getItem('budgetAppLang') || 'ru';
let currentTheme = localStorage.getItem('budgetAppTheme') || 'light';

if (currentTheme === 'dark') {
    document.body.classList.add('dark-theme');
    const btn = document.getElementById('themeBtn');
    if (btn) btn.textContent = 'â˜€ï¸';
}

function updateAppLanguage() {
    const t = translations[currentLang];
    const els = {
        balanceLabel: t.balance, syncStatus: t.synced,
        incomeLabel: t.monthIncome, expenseLabel: t.monthExpense,
        billsTitle: t.upcomingBills, transTitle: t.recentTrans,
        tabIncome: t.income, tabExpense: t.expense, tabBill: t.bill,
        amountLabel1: t.amount, amountLabel2: t.amount, amountLabel3: t.amount,
        descLabel1: t.description, descLabel2: t.description,
        dateLabel1: t.date, dateLabel2: t.date,
        categoryLabel: t.category, categoryLabel2: t.category,
        addIncomeBtn: t.addIncome, addExpenseBtn: t.addExpense, addBillBtn: t.addBill,
        billNameLabel: t.billName, dueLabel: t.dueDate, recurringLabel: t.recurring,
        allTransTitle: t.allTrans, statsTitle: t.categoryStats,
        navHome: t.home, navAdd: t.add, navHistory: t.history, navStats: t.stats,
        calcTitle: t.canSave, calcBalance: t.currentBal,
        calcBills: t.unpaidBills, calcFree: t.freeAmount
    };
    Object.keys(els).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.textContent = els[id];
    });
    
    const cats = [
        ['utilities', t.utilities], ['education', t.education],
        ['subscriptions', t.subscriptions], ['creditCards', t.creditCards],
        ['groceries', t.groceries], ['transport', t.transport],
        ['entertainment', t.entertainment], ['health', t.health],
        ['other', t.other]
    ];
    ['expenseCategory', 'billCategory'].forEach(id => {
        const sel = document.getElementById(id);
        if (sel) {
            const val = sel.value;
            sel.innerHTML = cats.map(([v, n]) => `<option value="${v}">${n}</option>`).join('');
            sel.value = val || 'utilities';
        }
    });
    
    document.querySelectorAll('.lang-btn-app').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === currentLang);
    });
}

function t(key) {
    return translations[currentLang][key] || key;
}

function getCategoryName(key) {
    return translations[currentLang][key] || key;
}

setTimeout(() => {
    updateAppLanguage();
    
    document.querySelectorAll('.lang-btn-app').forEach(btn => {
        btn.addEventListener('click', () => {
            currentLang = btn.dataset.lang;
            localStorage.setItem('budgetAppLang', currentLang);
            updateAppLanguage();
            if (window.updateUI) updateUI();
        });
    });
    
    const themeBtn = document.getElementById('themeBtn');
    if (themeBtn) {
        themeBtn.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            currentTheme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';
            localStorage.setItem('budgetAppTheme', currentTheme);
            themeBtn.textContent = currentTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        });
    }
}, 100);
